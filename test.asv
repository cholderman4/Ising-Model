TMAX = 1000;
E = zeros(1,TMAX);
p = 0.5;
m = 20;

[A, E(1,1)] = initializeSystem(p, m);
image([0 20], [0 20], A,'CDataMapping','scaled')


for t=1:TMAX
    [A, dE] = switchRandNode(A);
    E(1,t+1) = dE + E(1,t);
    image([0 20], [0 20], A,'CDataMapping','scaled')
    pause(.25)
end

T=1:TMAX+1;
plot(T, E)